function initialize(){function e(e){var t=navigator.onLine?"online":"offline";console.log(t),o.className=t,o.innerHTML="Browser is "+t.toUpperCase()+".","online"===t?$("#status").css({opacity:1,visibility:"visible"}).animate({opacity:0},3e3):(o.style.visibility="visible",o.style.opacity="1.0")}var o=document.getElementById("status");window.addEventListener("online",e),window.addEventListener("offline",e),city="Sydney",searchTerm="Sushi";var t={zoom:14,center:new google.maps.LatLng(-33.875,151.209)};map=new google.maps.Map(document.getElementById("map-canvas"),t),infowindow=new google.maps.InfoWindow({maxWidth:400,margin:20}),cityInfo(city),createArray(searchTerm,city),appViewModel.filteredItems=ko.computed(function(){var e=this.filter().toLowerCase();return e?this.resultsArray().filter(function(o){var t=o.name.toLowerCase().indexOf(e)>-1;return o.isVisible(t),t}):this.resultsArray()},appViewModel),ko.applyBindings(appViewModel),google.maps.event.addDomListener(window,"resize",function(){var e=map.getCenter();google.maps.event.trigger(map,"resize"),map.setCenter(e)}),google.maps.event.addDomListener(map,"click",function(){infowindow.close()}),$(document).keypress(function(e){var o=e.keyCode?e.keyCode:e.which;108===o&&$("#places-list").toggleClass("hidden")}),addEventListener("touchstart",function(e){e.touches[0];3==e.touches.length&&$("#places-list").toggleClass("hidden")},!1)}function cityInfo(e){var o=setTimeout(function(){alert("Wikipedia results failed to load. Please try again."),console.log("Ajax request failed to load wiki data")},4e3),t={url:"https://en.wikipedia.org/w/api.php",dataType:"jsonp",cache:!0,callback:"wikiCallback",data:{action:"opensearch",search:e,prop:"revisions"},success:function(e){new City(e),clearTimeout(o)},error:function(){console.log("Error")}};$.ajax(t)}function stringHTTPS(e){return e=e.split(":"),e=e[0]+"s:"+e[1]}var mapMarkers=[],map,infowindow,city,searchTerm,City=function(e){var o=e,t=this;t.name=o[0],t.info="<div class='content'><p>"+o[1][0]+"</p><p>"+o[2][0]+"</p><a target='_blank' href="+o[3][0]+'>Go to wikipedia page</a><iframe width="560" height="315" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"src="https://maps.google.com/maps?layer=c&amp;panoid=p-LCAk6lQAkAAAQo8D61dQ&amp;ie=UTF8&amp;source=embed&amp;output=svembed&amp;cbp=13%2C191.81697000000003%2C%2C0%2C0"></iframe><div><small><a href="https://www.google.com/maps/views/" style="color:#0000FF; text-align:left">Views</a>: <a href="https://www.google.com/maps/views/view/112608914008214588092/gphoto/6148751372575589474" style="color:#0000FF; text-align:left">Sydney - Pylon Lookout</a> by <a href="https://www.google.com/maps/views/profile/112608914008214588092" style="color:#0000FF; text-align:left">Olivier Wavre</a></small></div></div>';var i=new google.maps.Marker({position:new google.maps.LatLng(-33.875,151.209),map:map,animation:google.maps.Animation.DROP}),a=new google.maps.InfoWindow;google.maps.event.addListener(i,"click",function(){return function(){a.setContent(t.info),a.open(map,i)}}())},Pins=function(e,o){var t=this,i=e.businesses[o],a=stringHTTPS(i.image_url);t.name=i.name,t.lat=i.location.coordinate.latitude,t["long"]=i.location.coordinate.longitude,t.address=i.location.address[0]+", "+i.location.city+", "+i.location.display_address[3],t.info="<div id='content'><div id='siteNotice'></div><div id='bodyContent'><h2 class='text-center'>"+i.name+"</h2><p>"+i.snippet_text+"</p><p>Rating: "+i.rating+"</p><img src='"+a+"' height='100' width='100'><a target='_blank' href='http://maps.google.com/maps?q=&layer=c&cbll="+t.lat+","+t["long"]+"'><img src='https://maps.googleapis.com/maps/api/streetview?size=100x100&location="+t.lat+","+t["long"]+"' height='100' width='100'></a></div></div>",t.clicked=function(){infowindow.setContent(t.info),map.setCenter(n.position),infowindow.open(map,n)};var n=new google.maps.Marker({position:new google.maps.LatLng(t.lat,t["long"]),title:t.name,map:map,icon:"images/iconb"+(o+1)+".png",animation:google.maps.Animation.DROP});t.isVisible=ko.observable(),t.isVisible.subscribe(function(e){n.setMap(e?map:null)}),google.maps.event.addListener(n,"click",function(){return t.clicked}())},pushModelApp=function(e){var o,t=e.businesses,i=t.length;for(o=0;i>o;o++)mapMarkers.push(new Pins(e,o));appViewModel.resultsArray(mapMarkers)},createArray=function(e,o){function t(){return Math.floor(1e12*Math.random()).toString()}var i=setTimeout(function(){alert("Yelp results failed to load. Please try again."),console.log("Ajax request failed to load")},4e3),a="https://api.yelp.com/v2/search",n={term:e,location:o,radius_filter:5e3,oauth_consumer_key:"JiPu2WHv2CvMTu2KIJodFw",oauth_token:"a-iQofdMTAKu6n2T3R1i2GZ-FxbNstV3",oauth_nonce:t(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},s=oauthSignature.generate("GET",a,n,"w9FmW2cOcACjQqbBLn9j4f68GQI","1O1GK028G4wbFQtJz3F1FodA-5A");n.oauth_signature=s;var r={url:a,data:n,cache:!0,dataType:"jsonp",success:function(e){console.log(e),pushModelApp(e),clearTimeout(i)},error:function(){}};$.ajax(r)},appViewModel={filter:ko.observable(""),resultsArray:ko.observableArray([]),hideList:$("#places-toggle").click(function(){$("#places-list").toggleClass("hidden")})};google.maps.event.addDomListener(window,"load",initialize);