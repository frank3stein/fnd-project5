function initialize(){var e={zoom:12,center:new google.maps.LatLng(-33.9,151.2)};map=new google.maps.Map(document.getElementById("map-canvas"),e),infowindow=new google.maps.InfoWindow({maxWidth:200}),createArray("Sushi","Sydney"),appViewModel.filteredItems=ko.computed(function(){var e=this.filter().toLowerCase();return e?this.resultsArray().filter(function(o){var a=o.name.toLowerCase().indexOf(e)>-1;return o.isVisible(a),a}):this.resultsArray()},appViewModel),ko.applyBindings(appViewModel)}var mapMarkers=[],map,infowindow,centerMap=function(e){lat=e.region.center.latitude,long=e.region.center.longitude},Pins=function(e,o){var a=this,t=e.businesses[o];a.name=t.name,a.lat=t.location.coordinate.latitude,a["long"]=t.location.coordinate.longitude,a.info="<div id='content'><h2>"+t.name+"</h2><p>"+t.snippet_text+"</p><p>Rating:"+t.rating+"</p><img src='"+t.image_url+"'></div>",a.clicked=function(){infowindow.setContent(a.info),infowindow.open(map,n)};var n=new google.maps.Marker({position:new google.maps.LatLng(a.lat,a["long"]),title:a.name,map:map});a.isVisible=ko.observable(),a.isVisible.subscribe(function(e){n.setMap(e?map:null)}),google.maps.event.addListener(n,"click",function(){return a.clicked}())},pushModelApp=function(e){var o,a=e.businesses,t=a.length;for(o=0;t>o;o++)mapMarkers.push(new Pins(e,o));appViewModel.resultsArray(mapMarkers)},createArray=function(e,o){function a(){return Math.floor(1e12*Math.random()).toString()}var t=setTimeout(function(){alert("Yelp results failed to load. Please try again."),console.log("Ajax request failed to load")},2e3),n="https://api.yelp.com/v2/search",i={term:e,location:o,radius_filter:5e3,oauth_consumer_key:"JiPu2WHv2CvMTu2KIJodFw",oauth_token:"a-iQofdMTAKu6n2T3R1i2GZ-FxbNstV3",oauth_nonce:a(),oauth_timestamp:Math.floor(Date.now()/1e3),oauth_signature_method:"HMAC-SHA1",oauth_version:"1.0",callback:"cb"},r=oauthSignature.generate("GET",n,i,"w9FmW2cOcACjQqbBLn9j4f68GQI","1O1GK028G4wbFQtJz3F1FodA-5A");i.oauth_signature=r;var s={url:n,data:i,cache:!0,dataType:"jsonp",success:function(e){pushModelApp(e),clearTimeout(t)},error:function(){}};$.ajax(s)},appViewModel={filter:ko.observable(""),resultsArray:ko.observableArray([])};google.maps.event.addDomListener(window,"load",initialize);